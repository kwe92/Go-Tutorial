package main

import (
	"fmt"

	"github.com/tidwall/gjson"

	j "encoding/json"
)

type Transaction struct {
	Amount         float64
	BusinessName   string
	AuthorizedDate string
	CurrencyCode   string
	IsPending      bool
}

func main() {

	// Create an array of maps to store the data
	var arrayOfMaps []map[string]any

	var transactionRecords = []any{}

	// value := gjson.Get(json, "latest_transactions.#")

	value := gjson.Get(json, "latest_transactions")

	// Unmarshal the JSON string into the array of maps

	err := j.Unmarshal([]byte(value.String()), &arrayOfMaps)
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	for i := 0; i < len(arrayOfMaps); i++ {
		var transaction Transaction

		transaction.Amount = arrayOfMaps[i]["amount"].(float64)

		transaction.BusinessName = arrayOfMaps[i]["merchant_name"].(string)

		transaction.AuthorizedDate = arrayOfMaps[i]["authorized_date"].(string)

		transaction.CurrencyCode = arrayOfMaps[i]["iso_currency_code"].(string)

		transaction.IsPending = arrayOfMaps[i]["pending"].(bool)

		transactionRecords = append(transactionRecords, transaction)
	}

	for index, transaction := range transactionRecords {
		fmt.Println(index, transaction)

		// fmt.Printf("%d %+v", index, transaction)

	}

	jsonTransactions, _ := j.Marshal(transactionRecords)

	fmt.Println(string(jsonTransactions))

	// fmt.Println(value.String())

}

const json = `{"latest_transactions":[{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":12,"authorized_date":"2024-02-21","authorized_datetime":null,"category":["Food and Drink","Restaurants","Fast Food"],"category_id":"13005032","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"vzWXDWBjB06j5BJoD3Jo84OJZg7JJzmqOZA22","logo_url":"https://plaid-merchant-logos.plaid.com/mcdonalds_619.png","name":"McDonald's","phone_number":null,"type":"merchant","website":"mcdonalds.com"}],"date":"2024-02-21","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":"3322"},"logo_url":"https://plaid-merchant-logos.plaid.com/mcdonalds_619.png","merchant_name":"McDonald's","name":"McDonald's","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"FOOD_AND_DRINK_FAST_FOOD","primary":"FOOD_AND_DRINK"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_FOOD_AND_DRINK.png","transaction_code":null,"transaction_id":"ggoGEdXm5xTo5vZrAWaxSwPZRaaXZbfE9bLlL","transaction_type":"place","unofficial_currency_code":null,"website":"mcdonalds.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":-500,"authorized_date":"2024-02-22","authorized_datetime":null,"category":["Travel","Airlines and Aviation Services"],"category_id":"22001000","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"NKDjqyAdQQzpyeD8qpLnX0D6yvLe2KYKYYzQ4","logo_url":"https://plaid-merchant-logos.plaid.com/united_airlines_1065.png","name":"United Airlines","phone_number":null,"type":"merchant","website":"united.com"}],"date":"2024-02-22","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/united_airlines_1065.png","merchant_name":"United Airlines","name":"United Airlines","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"TRAVEL_FLIGHTS","primary":"TRAVEL"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_TRAVEL.png","transaction_code":null,"transaction_id":"ozvGlQDwBeUNqleDmxoXhK5BZRRQBrToAapXo","transaction_type":"special","unofficial_currency_code":null,"website":"united.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":5.4,"authorized_date":"2024-02-23","authorized_datetime":null,"category":["Travel","Taxi"],"category_id":"22016000","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd","logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","name":"Uber","phone_number":null,"type":"merchant","website":"uber.com"}],"date":"2024-02-24","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","merchant_name":"Uber","name":"Uber 063015 SF**POOL**","payment_channel":"online","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"TRANSPORTATION_TAXIS_AND_RIDE_SHARES","primary":"TRANSPORTATION"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_TRANSPORTATION.png","transaction_code":null,"transaction_id":"pBvyqZDW3QH5Kqj6AlepUj6KLPPwKzipe4JDL","transaction_type":"special","unofficial_currency_code":null,"website":"uber.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":6.33,"authorized_date":"2024-03-07","authorized_datetime":null,"category":["Travel","Taxi"],"category_id":"22016000","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd","logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","name":"Uber","phone_number":null,"type":"merchant","website":"uber.com"}],"date":"2024-03-08","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","merchant_name":"Uber","name":"Uber 072515 SF**POOL**","payment_channel":"online","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"TRANSPORTATION_TAXIS_AND_RIDE_SHARES","primary":"TRANSPORTATION"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_TRANSPORTATION.png","transaction_code":null,"transaction_id":"vNvwxyD8PoHWdN9ne6wBHRxRjgNgvauqAyyBA","transaction_type":"special","unofficial_currency_code":null,"website":"uber.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":89.4,"authorized_date":"2024-03-20","authorized_datetime":null,"category":["Food and Drink","Restaurants"],"category_id":"13005000","counterparties":[{"confidence_level":"LOW","entity_id":null,"logo_url":null,"name":"FUN","phone_number":null,"type":"merchant","website":null}],"date":"2024-03-21","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"merchant_name":"FUN","name":"SparkFun","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"LOW","detailed":"GENERAL_MERCHANDISE_OTHER_GENERAL_MERCHANDISE","primary":"GENERAL_MERCHANDISE"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_GENERAL_MERCHANDISE.png","transaction_code":null,"transaction_id":"9zJaPD79AmUKrVL9gXWQHJLJRrmrvlc4addww","transaction_type":"place","unofficial_currency_code":null},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":4.33,"authorized_date":"2024-03-22","authorized_datetime":null,"category":["Food and Drink","Restaurants","Coffee Shop"],"category_id":"13005043","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"NZAJQ5wYdo1W1p39X5q5gpb15OMe39pj4pJBb","logo_url":"https://plaid-merchant-logos.plaid.com/starbucks_956.png","name":"Starbucks","phone_number":null,"type":"merchant","website":"starbucks.com"}],"date":"2024-03-22","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/starbucks_956.png","merchant_name":"Starbucks","name":"Starbucks","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"FOOD_AND_DRINK_COFFEE","primary":"FOOD_AND_DRINK"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_FOOD_AND_DRINK.png","transaction_code":null,"transaction_id":"y7wX4yK8eEUKNPd1nJgkHNdNv4x4qlC4eVVbl","transaction_type":"place","unofficial_currency_code":null,"website":"starbucks.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":12,"authorized_date":"2024-03-22","authorized_datetime":null,"category":["Food and Drink","Restaurants","Fast Food"],"category_id":"13005032","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"vzWXDWBjB06j5BJoD3Jo84OJZg7JJzmqOZA22","logo_url":"https://plaid-merchant-logos.plaid.com/mcdonalds_619.png","name":"McDonald's","phone_number":null,"type":"merchant","website":"mcdonalds.com"}],"date":"2024-03-22","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":"3322"},"logo_url":"https://plaid-merchant-logos.plaid.com/mcdonalds_619.png","merchant_name":"McDonald's","name":"McDonald's","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"FOOD_AND_DRINK_FAST_FOOD","primary":"FOOD_AND_DRINK"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_FOOD_AND_DRINK.png","transaction_code":null,"transaction_id":"mKvGm7D8kjHWRd8AaeB9HpNpzr1rx9cgzBBn6","transaction_type":"place","unofficial_currency_code":null,"website":"mcdonalds.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":-500,"authorized_date":"2024-03-23","authorized_datetime":null,"category":["Travel","Airlines and Aviation Services"],"category_id":"22001000","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"NKDjqyAdQQzpyeD8qpLnX0D6yvLe2KYKYYzQ4","logo_url":"https://plaid-merchant-logos.plaid.com/united_airlines_1065.png","name":"United Airlines","phone_number":null,"type":"merchant","website":"united.com"}],"date":"2024-03-23","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/united_airlines_1065.png","merchant_name":"United Airlines","name":"United Airlines","payment_channel":"in store","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"TRAVEL_FLIGHTS","primary":"TRAVEL"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_TRAVEL.png","transaction_code":null,"transaction_id":"bMZGLrXmJKUqKnpjALavHEKEda4aJnFmQAA1a","transaction_type":"special","unofficial_currency_code":null,"website":"united.com"},{"account_id":"lk6GbjDyKPt1PJeQdZypsgvlejvRA7Up6yBZy","account_owner":null,"amount":5.4,"authorized_date":"2024-03-24","authorized_datetime":null,"category":["Travel","Taxi"],"category_id":"22016000","counterparties":[{"confidence_level":"VERY_HIGH","entity_id":"eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd","logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","name":"Uber","phone_number":null,"type":"merchant","website":"uber.com"}],"date":"2024-03-25","datetime":null,"iso_currency_code":"USD","location":{"address":null,"city":null,"country":null,"lat":null,"lon":null,"postal_code":null,"region":null,"store_number":null},"logo_url":"https://plaid-merchant-logos.plaid.com/uber_1060.png","merchant_name":"Uber","name":"Uber 063015 SF**POOL**","payment_channel":"online","payment_meta":{"by_order_of":null,"payee":null,"payer":null,"payment_method":null,"payment_processor":null,"ppd_id":null,"reason":null,"reference_number":null},"pending":false,"pending_transaction_id":null,"personal_finance_category":{"confidence_level":"VERY_HIGH","detailed":"TRANSPORTATION_TAXIS_AND_RIDE_SHARES","primary":"TRANSPORTATION"},"personal_finance_category_icon_url":"https://plaid-category-icons.plaid.com/PFC_TRANSPORTATION.png","transaction_code":null,"transaction_id":"nrvGyeD8z7hplgZR4MxmcVEVk5o5gmFAw11Nz","transaction_type":"special","unofficial_currency_code":null,"website":"uber.com"}]}`
